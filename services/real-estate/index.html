<!-- /components/forms/estimate.html -->
<section class="lead-form card airy" aria-label="Request information or a call back">
  <style>
    /* Scoped to this include */
    .lead-form{--line:#e2e8f0;--muted:#64748b;--ink:#0b3a6f;--bg:#f8fafc;--radius:14px;}
    .lead-form .head{display:flex;flex-direction:column;gap:6px;margin-bottom:14px}
    .lead-form .kicker{display:inline-block;background:#eef2ff;color:#334155;border-radius:999px;padding:6px 10px;font-weight:700}
    .lead-form h2{margin:4px 0;color:var(--ink)}
    .lead-form p.muted{color:var(--muted);margin:0}
    .lead-form .quick{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .lead-form .qbtn{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;border:1px solid var(--line);border-radius:12px;font-weight:700;background:#fff}
    .lead-form .qbtn.primary{background:#0b3a6f;color:#fff;border-color:#0b3a6f}
    .lead-form form{display:grid;gap:10px}
    .lead-form .row{display:grid;gap:10px}
    @media(min-width:720px){.lead-form .row.cols-2{grid-template-columns:1fr 1fr}}
    @media(min-width:900px){.lead-form .row.cols-3{grid-template-columns:1fr 1fr 1fr}}
    .lead-form label{font-weight:700;color:#0f172a}
    .lead-form input,.lead-form select,.lead-form textarea{
      border:1px solid var(--line);border-radius:12px;padding:12px 12px;background:#fff;font:inherit
    }
    .lead-form textarea{min-height:110px;resize:vertical}
    .lead-form .hint{font-size:.9rem;color:var(--muted)}
    .lead-form .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:6px}
    .lead-form .btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 16px;border-radius:12px;border:1px solid #0b3a6f;font-weight:800}
    .lead-form .btn.primary{background:#0b3a6f;color:#fff}
    .lead-form .btn.ghost{background:#fff;color:#0b3a6f}
    .lead-form .note{font-size:.9rem;color:var(--muted)}
    .lead-form .divider{height:1px;background:var(--line);margin:6px 0}
  </style>

  <div class="head">
    <span class="kicker">Request Info / Schedule</span>
    <h2>Tell us about your roof—we’ll follow up fast</h2>
    <p class="muted">Use this form to request information, scheduling, or pricing. Or contact us directly:</p>
    <div class="quick" role="navigation" aria-label="Quick contact">
      <a class="qbtn primary" href="tel:8589006163">Call 858-900-6163</a>
      <a class="qbtn" href="sms:+18589006163">Text Us</a>
    </div>
  </div>

  <form id="estimate-form" novalidate>
    <!-- Contact -->
    <div class="row cols-2">
      <div>
        <label for="name">Full Name *</label>
        <input id="name" name="name" type="text" autocomplete="name" required />
      </div>
      <div>
        <label for="phone">Phone *</label>
        <input id="phone" name="phone" type="tel" inputmode="tel" autocomplete="tel" required />
      </div>
    </div>
    <div class="row cols-2">
      <div>
        <label for="email">Email</label>
        <input id="email" name="email" type="email" autocomplete="email" />
      </div>
      <div>
        <label for="contact_pref">Preferred Contact</label>
        <select id="contact_pref" name="contact_pref">
          <option value="">No preference</option>
          <option>Call</option>
          <option>Text</option>
          <option>Email</option>
        </select>
      </div>
    </div>

    <!-- Property -->
    <div class="row cols-3">
      <div>
        <label for="address">Property Address *</label>
        <input id="address" name="address" type="text" autocomplete="street-address" required />
      </div>
      <div>
        <label for="city">City *</label>
        <input id="city" name="city" type="text" required />
      </div>
      <div>
        <label for="zip">ZIP *</label>
        <input id="zip" name="zip" type="text" inputmode="numeric" pattern="[0-9]*" required />
      </div>
    </div>

    <!-- Service -->
    <div class="row cols-2">
      <div>
        <label for="service">What do you need? *</label>
        <select id="service" name="service" required>
          <option value="">Select one…</option>
          <optgroup label="Real-Estate">
            <option>Visual Roof Inspection ($295)</option>
            <option>Real-Estate Roof Estimate ($295)</option>
            <option>Roof Certification ($395)</option>
            <option>Certified Roof Report ($495)</option>
            <option>Verbal Roof Opinion (Free)</option>
            <option>Satellite Imagery Analysis (Call for pricing)</option>
          </optgroup>
          <optgroup label="Homeowners / Repairs">
            <option>Homeowner Roof Inspection (Free)</option>
            <option>Roof Tune-Up (Quote)</option>
            <option>Tile Roof Repair (Quote)</option>
            <option>Asphalt Shingle Roof (Quote)</option>
            <option>Flat / Low-Slope Roof (Quote)</option>
          </optgroup>
          <optgroup label="Insurance">
            <option>Storm Damage Inspection for Claim (Free)</option>
            <option>Insurance Letter / Third Party Request ($295)</option>
          </optgroup>
          <optgroup label="Other">
            <option>Gutters / Guards (Quote)</option>
            <option>Other / Not sure</option>
          </optgroup>
        </select>
      </div>
      <div>
        <label for="timeline">Timeline</label>
        <select id="timeline" name="timeline">
          <option value="">Select…</option>
          <option>ASAP (in escrow)</option>
          <option>1–2 weeks</option>
          <option>2–4 weeks</option>
          <option>Just planning</option>
        </select>
      </div>
    </div>

    <!-- Details -->
    <div>
      <label for="details">Notes for our team</label>
      <textarea id="details" name="details" placeholder="Tell us about leaks, age, material, or what triggered this request."></textarea>
      <p class="hint">You can also reply with photos after we follow up.</p>
    </div>

    <!-- Consent -->
    <div>
      <label class="note">
        <input type="checkbox" name="ok_to_text" value="yes" />
        OK to text me about this request
      </label>
    </div>

    <!-- Hidden context populated by /js/estimate-form.js -->
    <input type="hidden" name="category" value="">
    <input type="hidden" name="page_url" value="">
    <input type="hidden" name="page_title" value="">
    <input type="hidden" name="context" value="">

    <div class="divider" role="presentation"></div>

    <!-- Actions -->
    <div class="actions">
      <button class="btn primary" type="submit">Send Request</button>
      <a class="btn ghost" href="tel:8589006163">Or Call 858-900-6163</a>
    </div>

    <p class="note">Submitting this form does not place an order or schedule work; it simply lets us contact you to discuss your roof and next steps.</p>
  </form>

  <script>
    // Light integration with your existing /js/estimate-form.js (if present)
    (function(){
      try{
        // Fill hidden context if parent set data attributes
        const host = document.currentScript.closest('[data-estimate-context]') || document;
        const form = document.getElementById('estimate-form');
        if(!form) return;
        const get = (name)=> form.querySelector(`input[name="${name}"]`);
        const ctx = host.getAttribute('data-estimate-context') || '';
        const cat = host.getAttribute('data-category') || '';
        const redir = host.getAttribute('data-redirect') || '';

        if(get('context')) get('context').value = ctx;
        if(get('category')) get('category').value = cat;
        if(get('page_url')) get('page_url').value = location.href;
        if(get('page_title')) get('page_title').value = document.title;

        // If your global handler exists, let it take over
        if (window.initEstimateForm) {
          window.initEstimateForm(form, { redirect: redir });
        } else {
          // Minimal fallback submission (no backend, just mailto as a backup)
          form.addEventListener('submit', function(e){
            e.preventDefault();
            const data = new FormData(form);
            const subject = encodeURIComponent('Website Request: ' + (data.get('service') || 'Roofing'));
            const lines = [];
            for (const [k,v] of data.entries()){
              if(['page_url','page_title','category','context','ok_to_text'].includes(k) || v) {
                lines.push(`${k}: ${v}`);
              }
            }
            const body = encodeURIComponent(lines.join('\n'));
            // Try redirect param first
            if (redir) { window.location.assign(redir); }
            // Fallback mailto (user can still call/text from sticky bar)
            window.location.href = `mailto:info@zenithroofingservices.com?subject=${subject}&body=${body}`;
          });
        }
      }catch(e){}
    })();
  </script>
</section>
